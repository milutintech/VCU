\doxysection{vehicle\+\_\+control.\+h}
\hypertarget{vehicle__control_8h_source}{}\label{vehicle__control_8h_source}\index{include/vehicle\_control.h@{include/vehicle\_control.h}}
\mbox{\hyperlink{vehicle__control_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <Arduino.h>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config_8h}{config.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vehicle__parameters_8h}{vehicle\_parameters.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}ADS1X15.h"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_vehicle_control}{VehicleControl}}\ \{}
\DoxyCodeLine{00021\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{class_vehicle_control_a58a56e235f86e223c10a168e13f6a81f}{VehicleControl}}(ADS1115\&\ \mbox{\hyperlink{class_vehicle_control_a5b359885d36fd5b369b5fe9ba245e26f}{ads}});}
\DoxyCodeLine{00027\ \ \ \ \ }
\DoxyCodeLine{00032\ \ \ \ \ int16\_t\ \mbox{\hyperlink{class_vehicle_control_a4a40ba078d06a53fb52153d80c01ae69}{calculateTorque}}();}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_vehicle_control_a7a598d53412fde2f576e731976bf1629}{setMotorSpeed}}(\textcolor{keywordtype}{float}\ speed);}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_vehicle_control_a6a0ec19cf7b6ede44ff761bfcfe4207c}{setCurrentGear}}(\mbox{\hyperlink{config_8h_a8c420f89485dc6c08d6e89605a8166cd}{GearState}}\ gear);}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_vehicle_control_a84d97a2f0b89b4e85f54a62871bf621e}{setDrivingMode}}(\mbox{\hyperlink{config_8h_a785f94b7f1a29eb5a7001c09bad64c01}{DriveMode}}\ mode);}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_vehicle_control_ab46abdeb60d341fa0547ab07f007037f}{isDMCEnabled}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00057\ \ \ \ \ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{//\ Configuration\ methods}}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_vehicle_control_aeeead8dc56ced72558564016510265e4}{setOPDEnabled}}(\textcolor{keywordtype}{bool}\ enabled)\ \{\ \mbox{\hyperlink{class_vehicle_control_a31ba729072fde5c4b6ea6e54f5b3fd9b}{isOPDEnabled}}\ =\ enabled;\ \}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_vehicle_control_a874a9f63a0ed236f177518c5ca4c8e28}{setRegenEnabled}}(\textcolor{keywordtype}{bool}\ enabled)\ \{\ \mbox{\hyperlink{class_vehicle_control_a407b8ad28e14e934e93929f9b6d90628}{isRegenEnabled}}\ =\ enabled;\ \}}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_vehicle_control_acc1490071b408dc62e2ec309715e1ce0}{setGearRatio}}(\mbox{\hyperlink{config_8h_ac5e05c5a7d57d23d56fbc19df0ecf645}{GearRatio}}\ ratio)\ \{\ \mbox{\hyperlink{class_vehicle_control_af6fe4aa401a18c4fe479a051817a089b}{currentGearRatio}}\ =\ ratio;\ \}}
\DoxyCodeLine{00062\ \ \ \ \ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_vehicle_control_a80eda80a14c3c360773c8086d0300f7f}{MAX\_VEHICLE\_SPEED}}\ =\ 120.0f;\ \ \textcolor{comment}{//\ kph}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00070\ \ \ \ \ int32\_t\ \mbox{\hyperlink{class_vehicle_control_aaa67e6a454776e4134c9c8799104d075}{samplePedalPosition}}();}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_vehicle_control_aab4410aea7677f92f31aafbf87a27979}{calculateVehicleSpeed}}();}
\DoxyCodeLine{00077\ \ \ \ \ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ Driving\ mode\ handlers}}
\DoxyCodeLine{00079\ \ \ \ \ int16\_t\ \mbox{\hyperlink{class_vehicle_control_aee3609644506e5b76ac02108f7d5d07b}{handleLegacyMode}}(\textcolor{keywordtype}{float}\ throttlePosition);}
\DoxyCodeLine{00080\ \ \ \ \ int16\_t\ \mbox{\hyperlink{class_vehicle_control_a4399007eb8ef230f01e6227e2a7bae78}{handleRegenMode}}(\textcolor{keywordtype}{float}\ throttlePosition,\ \textcolor{keywordtype}{float}\ speed);}
\DoxyCodeLine{00081\ \ \ \ \ int16\_t\ \mbox{\hyperlink{class_vehicle_control_a2f07a054eade29547b88842b35bb65c3}{handleOPDMode}}(\textcolor{keywordtype}{float}\ throttlePosition,\ \textcolor{keywordtype}{float}\ speed);}
\DoxyCodeLine{00082\ \ \ \ \ }
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ OPD\ calculations}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_vehicle_control_aa8e205ba6872b201ea8a00470c4fa2ac}{calculateCoastUpperBound}}(\textcolor{keywordtype}{float}\ speed);}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_vehicle_control_ad4c6b681f6a2afc16f956c5611819d97}{calculateCoastLowerBound}}(\textcolor{keywordtype}{float}\ speed);}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_vehicle_control_a7f9a52358ede7c2106524c824f238a8d}{calculateMaxRegenerativeTorque}}(\textcolor{keywordtype}{float}\ speed);}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_vehicle_control_a8e1f3cbeef05da62109a83d2d4c7c026}{calculateMaxDriveTorque}}(\textcolor{keywordtype}{float}\ speed);}
\DoxyCodeLine{00088\ \ \ \ \ }
\DoxyCodeLine{00094\ \ \ \ \ int16\_t\ \mbox{\hyperlink{class_vehicle_control_a5cb0e6e6505a509172f20331ff84942e}{applyTorqueLimits}}(int16\_t\ requestedTorque);}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00101\ \ \ \ \ int16\_t\ \mbox{\hyperlink{class_vehicle_control_a30cf56fd18bf83a739cf93f9ce411197}{applyDeadbandHysteresis}}(int16\_t\ torque);}
\DoxyCodeLine{00102\ \ \ \ \ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ Member\ variables}}
\DoxyCodeLine{00104\ \ \ \ \ ADS1115\&\ \mbox{\hyperlink{class_vehicle_control_a5b359885d36fd5b369b5fe9ba245e26f}{ads}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reference\ to\ ADC}}
\DoxyCodeLine{00105\ \ \ \ \ \mbox{\hyperlink{config_8h_a785f94b7f1a29eb5a7001c09bad64c01}{DriveMode}}\ \mbox{\hyperlink{class_vehicle_control_abfc6ce11a4e233ef219d263436f85ea7}{currentDrivingMode}};\ \ \ \ \textcolor{comment}{//\ Current\ driving\ mode}}
\DoxyCodeLine{00106\ \ \ \ \ \mbox{\hyperlink{config_8h_a8c420f89485dc6c08d6e89605a8166cd}{GearState}}\ \mbox{\hyperlink{class_vehicle_control_a45a0e34140d9e5c07e98ae707cc33d0d}{currentGear}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Current\ gear\ state}}
\DoxyCodeLine{00107\ \ \ \ \ \mbox{\hyperlink{config_8h_ac5e05c5a7d57d23d56fbc19df0ecf645}{GearRatio}}\ \mbox{\hyperlink{class_vehicle_control_af6fe4aa401a18c4fe479a051817a089b}{currentGearRatio}};\ \ \ \ \ \ \textcolor{comment}{//\ Current\ gear\ ratio}}
\DoxyCodeLine{00108\ \ \ \ \ }
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_vehicle_control_a31ba729072fde5c4b6ea6e54f5b3fd9b}{isOPDEnabled}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ OPD\ mode\ flag}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_vehicle_control_a407b8ad28e14e934e93929f9b6d90628}{isRegenEnabled}};\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Regeneration\ enabled\ flag}}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_vehicle_control_a104e3171491dfa479f76ccc36502679b}{enableDMC}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ DMC\ enable\ flag}}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_vehicle_control_a903dc2b6279d04f50eb8c2c33f9cf537}{wasInDeadband}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Deadband\ hysteresis\ state}}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_vehicle_control_a691c84d9e1b5ad1eee5147433f0c6726}{wasEnabled}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Previous\ enable\ state}}
\DoxyCodeLine{00114\ \ \ \ \ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_vehicle_control_a0cdfc88cd1fcab4476cba7dff02817ff}{lastTorque}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Last\ calculated\ torque}}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_vehicle_control_a688b949933676e0ca5db45863020a0e7}{motorSpeed}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Current\ motor\ speed}}
\DoxyCodeLine{00117\ \};}

\end{DoxyCode}
