\doxysection{state\+\_\+manager.\+h}
\hypertarget{state__manager_8h_source}{}\label{state__manager_8h_source}\index{include/state\_manager.h@{include/state\_manager.h}}
\mbox{\hyperlink{state__manager_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <Arduino.h>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config_8h}{config.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vehicle__parameters_8h}{vehicle\_parameters.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_c_a_n_manager}{CANManager}};\ \textcolor{comment}{//\ Forward\ declaration}}
\DoxyCodeLine{00019\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_state_manager}{StateManager}}\ \{}
\DoxyCodeLine{00020\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{class_state_manager_a76acd0244b310927e05e5603de4ef7e1}{StateManager}}(\mbox{\hyperlink{class_c_a_n_manager}{CANManager}}\&\ canMgr);\ \ \ \ }
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_a81d6c48d941963ab5be7a1e642c26d98}{update}}();}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_ae698ee0fb986e6b7790d6a17c9a26b82}{handleWakeup}}();}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00038\ \ \ \ \ \mbox{\hyperlink{config_8h_a75c52206c3c79acb62c0fddc66df3676}{VehicleState}}\ \mbox{\hyperlink{class_state_manager_abee5d1a12b2e2e2c65c7bb57fbf2afde}{getCurrentState}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_state_manager_abdcc20b128f2755ebff3592e52a1cbf2}{currentState}};\ \}}
\DoxyCodeLine{00039\ \ \ \ \ }
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{comment}{//\ State\ transitions}}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_ae5c5c65a30ed18704ead8ab6bac0e608}{transitionToStandby}}();}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_a4c7d5023fa1afaa5a6ae7a176c106895}{transitionToRun}}();}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_a5de7e06f9dbe763fb6e7d96a959b1f21}{transitionToCharging}}();}
\DoxyCodeLine{00058\ \ \ \ \ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ System\ control}}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_ae7b7fe0bbdc1018e0683e0d4a1e90df6}{armBattery}}(\textcolor{keywordtype}{bool}\ arm);}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_a9de72e8814ed32c0f4fb620eec8d41d8}{armCoolingSys}}(\textcolor{keywordtype}{bool}\ arm);}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_a948dd49f7218e33117d6348f791bbd55}{chargeManage}}();}
\DoxyCodeLine{00079\ \ \ \ \ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ Status\ methods}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_ac51f9905f1fb6b8ecf03b89a35a63ca9}{isBatteryArmed}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_state_manager_a911c4a5f4c4fc5d8d166409a6dd6feb5}{batteryArmed}};\ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_aabaa37dcac44049607ea3ae8b64a3335}{isPreCharged}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_state_manager_a854c82f75852c57160a46a6bce3b5901}{hasPreCharged}};\ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a84ea8f71fb6d763cdbc205ebcbd6a232}{isCharging}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_state_manager_abdcc20b128f2755ebff3592e52a1cbf2}{currentState}}\ ==\ \mbox{\hyperlink{config_8h_a75c52206c3c79acb62c0fddc66df3676a3a8ea4a62d0682faf83d7372669b5e9b}{VehicleState::CHARGING}};\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a48081c08f644ed48a0cca561310db878}{isConnectorLocked}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_state_manager_a406040789a1b551912daeea93c5072ec}{connectorLocked}};\ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00109\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{class_state_manager_afdfb122418abcbf5d99e85cf547fc4c0}{getWakeupReason}}();}
\DoxyCodeLine{00110\ \ \ \ \ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ Configuration\ methods}}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_a12174d1a76e2fa12eb0c1d16b55764f5}{setBatteryVoltage}}(uint16\_t\ voltage)\ \{\ \mbox{\hyperlink{class_state_manager_a48cb157ae9ca2f82a324c668db37f9e5}{batteryVoltage}}\ =\ voltage;\ \}}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_a24a16da5b3f05f322340dc935650d87e}{setInverterTemp}}(\textcolor{keywordtype}{float}\ temp)\ \{\ \mbox{\hyperlink{class_state_manager_aa57c6c93846cc017830e9847919af81f}{inverterTemp}}\ =\ temp;\ \}}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_af14813c64481da905dc9e53877a9cc8a}{setMotorTemp}}(\textcolor{keywordtype}{float}\ temp)\ \{\ \mbox{\hyperlink{class_state_manager_aa10509cf3a8d459cf85e7b43658aa53f}{motorTemp}}\ =\ temp;\ \}}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_a126ef9445ee529fa3d83be0d4bd825e4}{setCoolingRequest}}(uint8\_t\ request)\ \{\ \mbox{\hyperlink{class_state_manager_a0851805b171942f25e6f1f40849ed94e}{coolingRequest}}\ =\ request;\ \}}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_aceb7b86c640bcdd54fd94b5cdcdecc74}{setHVVoltageActual}}(\textcolor{keywordtype}{float}\ voltage)\ \{\ \mbox{\hyperlink{class_state_manager_a6ea9ae4e08f875031d5a008fc5736fc8}{hvVoltageActual}}\ =\ voltage;\ \}}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_aee79788443117d48ac4124b22ceb4724}{setHVVoltage}}(uint16\_t\ voltage)\ \{\ \mbox{\hyperlink{class_state_manager_a1b8041afd24d472be63a42f2d83a3cc3}{hvVoltage}}\ =\ voltage;\ \}}
\DoxyCodeLine{00118\ \ \ \ \ uint16\_t\ \mbox{\hyperlink{class_state_manager_aca4a6b00dffd598a526f14643c0e7ce5}{getHVVoltage}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_state_manager_a1b8041afd24d472be63a42f2d83a3cc3}{hvVoltage}};\ \}}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_state_manager_ab6100d9309a59c6099dbc28c4316e2f7}{getHVVoltageActual}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_state_manager_a6ea9ae4e08f875031d5a008fc5736fc8}{hvVoltageActual}};\ \}}
\DoxyCodeLine{00120\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{comment}{//\ Private\ member\ functions}}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_a89c8beceadb6aba3725d3a583a4f01d3}{handleStandbyState}}();}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_a1f16a49ecbbb069166eb2883a7ff4591}{handleRunState}}();}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_abfcbdbaff125ae6d962549882335e9e8}{handleChargingState}}();}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_abc0fc265ea74e974fdf4eb4c369adb87}{handleConnectorUnlock}}();}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_state_manager_ab4d30fe38f27a5dbd12363e959b70fdf}{handlePersistentUnlock}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\&\ unlockTimeout);}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{comment}{//\ System\ references}}
\DoxyCodeLine{00129\ \ \ \ \ \mbox{\hyperlink{class_c_a_n_manager}{CANManager}}\&\ \mbox{\hyperlink{class_state_manager_af91a817ac566236e2870a866995c456d}{canManager}};}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{comment}{//\ Internal\ state\ variables}}
\DoxyCodeLine{00132\ \ \ \ \ \mbox{\hyperlink{config_8h_a75c52206c3c79acb62c0fddc66df3676}{VehicleState}}\ \mbox{\hyperlink{class_state_manager_abdcc20b128f2755ebff3592e52a1cbf2}{currentState}};\ \ \ \ \ \textcolor{comment}{//\ Current\ vehicle\ operational\ state}}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a911c4a5f4c4fc5d8d166409a6dd6feb5}{batteryArmed}};\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Battery\ system\ active\ flag}}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a854c82f75852c57160a46a6bce3b5901}{hasPreCharged}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Precharge\ complete\ flag}}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a43b93b091b97ec4b1c2224d20e3e74e5}{nlgCharged}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Charge\ complete\ flag}}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a406040789a1b551912daeea93c5072ec}{connectorLocked}};\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Charge\ connector\ state}}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a976d42b3968564a0456c073b36894c8e}{unlockPersist}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Persistent\ unlock\ request\ flag}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a3aa030b95942adb7986b3319abc4e02c}{conUlockInterrupt}};\ \ \ \ \ \ \ \textcolor{comment}{//\ Connector\ unlock\ interrupt\ flag}}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a48537ec445ff8d66cb9977f8820cf5dd}{enableBSC}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ BSC\ enable\ state}}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a99c5ac54d6186c257e7cf59041a12d5e}{modeBSC}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ BSC\ mode\ (buck/boost)}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_adf75c08507f42721af2ac30dba129cd0}{errorLatch}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Error\ state\ latch}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_acb440cdcaed11f13b73941b7adafe1a8}{enableDMC}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ DMC\ enable\ state}}
\DoxyCodeLine{00143\ \ \ \ \ }
\DoxyCodeLine{00144\ \ \ \ \ \mbox{\hyperlink{config_8h_a8c420f89485dc6c08d6e89605a8166cd}{GearState}}\ \mbox{\hyperlink{class_state_manager_a2c40afa83f250c64421aca80f1e4eab8}{currentGear}}\ =\ \mbox{\hyperlink{config_8h_a8c420f89485dc6c08d6e89605a8166cda31ba17aa58cdb681423f07ca21a6efc7}{GearState::NEUTRAL}};\ \ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_state_manager_a789a97e89fc4c11e4541abc2e3b08ea4}{unlockConnectorRequest}}\ =\ \textcolor{keyword}{false};\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{comment}{//\ System\ parameters}}
\DoxyCodeLine{00148\ \ \ \ \ uint16\_t\ \mbox{\hyperlink{class_state_manager_a48cb157ae9ca2f82a324c668db37f9e5}{batteryVoltage}};\ \ \ \ \ \ \textcolor{comment}{//\ Current\ battery\ voltage}}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_state_manager_aa57c6c93846cc017830e9847919af81f}{inverterTemp}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Inverter\ temperature}}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_state_manager_aa10509cf3a8d459cf85e7b43658aa53f}{motorTemp}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Motor\ temperature}}
\DoxyCodeLine{00151\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{class_state_manager_a0851805b171942f25e6f1f40849ed94e}{coolingRequest}};\ \ \ \ \ \ \ \textcolor{comment}{//\ Cooling\ system\ demand}}
\DoxyCodeLine{00152\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{class_state_manager_ac860df5618ddc4e8601cc3bf26539d4d}{chargerState}};\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Current\ charger\ state}}
\DoxyCodeLine{00153\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{class_state_manager_adacb6ae71caafe77cf8b3d9599e908f7}{chargerStateDemand}};\ \ \ \textcolor{comment}{//\ Requested\ charger\ state}}
\DoxyCodeLine{00154\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{class_state_manager_a9c4bd962a0a27709da96637aab1bc549}{chargeLedDemand}};\ \ \ \ \ \ \textcolor{comment}{//\ Charge\ LED\ state\ request}}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{class_state_manager_a6ea9ae4e08f875031d5a008fc5736fc8}{hvVoltageActual}};\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Actual\ HV\ bus\ voltage}}
\DoxyCodeLine{00156\ \ \ \ \ uint16\_t\ \mbox{\hyperlink{class_state_manager_a1b8041afd24d472be63a42f2d83a3cc3}{hvVoltage}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Target\ HV\ bus\ voltage}}
\DoxyCodeLine{00157\ \ \ \ \ }
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{comment}{//\ Timing\ management}}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{class_state_manager_a750dcf6d290875102ea4b588c4e4ee61}{lastModeChangeTime}};\ \ \ \ \ \ \textcolor{comment}{//\ Last\ state\ change\ timestamp}}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{class_state_manager_a459c7d3909d464353eae07ecbaa1b450}{lastPrechargeAttempt}};\ \ \ \ \textcolor{comment}{//\ Last\ precharge\ attempt\ timestamp}}
\DoxyCodeLine{00161\ \};}

\end{DoxyCode}
